<!--
    --------------------------------------------------------------------------------------------------------
    This page handles all the UI for the sending emails out from Lightning pages in CRM Mortgages Accreditation Functionality
    --------------------------------------------------------------------------------------------------------
    Created Date: 05-APR-2017         Created By: Pawan Mudgal            Email: pawan.mudgal@saasfocus.com
    --------------------------------------------------------------------------------------------------------
-->
<apex:page id="Page" standardController="Case" extensions="CRM_Mtg_SendNewEmailController" showHeader="false" sidebar="false" standardStylesheets="true" docType="html-5.0" applyBodyTag="false" applyHtmlTag="false">
    <html>
        <head> 
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
            <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"/>
            <apex:includeScript value="{!URLFOR($Resource.bootstrap, 'js/bootstrap.min.js')}" />
            <apex:includeScript value="{!URLFOR($Resource.scCollectionConsoleResources, 'js/modernizr-custom.js')}" />
            
            <apex:stylesheet value="{!URLFOR($Resource.bootstrap,'css/bootstrap-theme.css')}"/>
            <apex:stylesheet value="{!URLFOR($Resource.bootstrap,'css/bootstrap.css')}"/>
            <apex:stylesheet value="{!URLFOR($Resource.scCollectionConsoleResources,'css/bootstrap.min.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.scCollectionConsoleResources,'css/font-awesome.css')}" />
            <apex:stylesheet value="{!URLFOR($Resource.scCollectionConsoleResources,'css/component.css')}" />
            
            <script type="text/javascript">
                jQuery(document).ready(function()
                {
                    
                }); 
                
                function ValidateSubmit()
                {
                    SendEmail_AF();
                }
                
                function reloadParent()
                {
                    setTimeout(function(){ document.getElementById('time').innerHTML = '4'; }, 1000);
                    setTimeout(function(){ document.getElementById('time').innerHTML = '3'; }, 2000);
                    setTimeout(function(){ document.getElementById('time').innerHTML = '2'; }, 3000);
                    setTimeout(function(){ document.getElementById('time').innerHTML = '1'; }, 4000);
                    setTimeout(function(){ window.top.location = '/{!strCaseId}';}, 5000);
                }
            </script>
            <style>
                .cstm-btn
                {
                    background: none !important;
                    background-color: rgb(0, 112, 210) !important;
                    border: 1px solid rgb(0, 112, 210) !important;
                    color: rgb(255, 255, 255) !important;
                    background-clip: border-box !important;
                    font-size: 1em !important;
                    line-height: 1.8em !important;
                    padding: 2px 15px !important;
                }
            </style>
        </head>
        <body>
            <section id="main-section">
                <div class="container-fluid">
                    <apex:form id="frm" style="margin-top:5px;">
                        
                        <apex:actionStatus id="OutPanelRenderer" layout="block" startStyleClass="customLoading" styleClass="customLoading"/>
                        <apex:actionFunction action="{!SendEmail}" name="SendEmail_AF" reRender="email_Panel" status="OutPanelRenderer"/>
                        
                        <apex:outputPanel rendered="{!isClosed}">
                            <div class="alert alert-danger" style="margin-top:20px; padding:20px;">
                              <strong>Sorry!</strong> You cannot send email from a closed case, please reopen the case.
                            </div>
                        </apex:outputPanel>
                        
                        <apex:outputPanel rendered="{!isError}">
                            <div class="alert alert-danger" style="margin-top:20px; padding:20px;">
                              <strong>Sorry!</strong> {!strErrorMsg}
                            </div>
                        </apex:outputPanel>
                        
                        <apex:outputPanel id="email_Panel" rendered="{!NOT(isClosed) && NOT(isError)}">
                            <apex:outputPanel rendered="{!emailSent}">
                                <div class="alert alert-success" style="margin-top:20px; padding:20px;">
                                    <strong>Success!</strong> Email sent successfully. Refreshing page in <label id="time">5</label> seconds.
                                </div>
                                <script>
                                    reloadParent();
                                </script>
                            </apex:outputPanel>
                            
                            <aside id="center_panel" class="col-md-12 col-sm-12" style="padding:10px 0px;">
                                <section class="cstm-form clearfix">
                                    <apex:outputPanel rendered="{!showEmailPreview}">
                                        <div class="col-md-12 col-sm-12 iframe-sm-12 form-group" style="text-align: center;">
                                            <button type="button" class="cstm-btn" onclick="ValidateSubmit();">Send Email</button>
                                        </div>
                                        <div class="clearfix"></div>
                                    </apex:outputPanel>
                                    <div class="col-md-2 col-sm-2 iframe-sm-2 form-group" style="padding-left:0px;text-align: center;margin-top: 5px;margin-bottom: 0px;">
                                        <label>Select Template</label>
                                    </div>
                                    <div class="col-md-10 col-sm-10 iframe-sm-10 form-group" style="padding-left:0px;">
                                        <apex:selectList id="templatelist" value="{!strSelectedTemplate}" styleClass="form-control requiredField selectlist" multiselect="false" size="1">
                                            <apex:selectOptions value="{!EmailTemplateList}" id="fieldoption" />
                                            <apex:actionSupport action="{!SelectTemplate}" event="onchange" reRender="email_Panel" status="OutPanelRenderer"/>
                                        </apex:selectList>
                                        <div class="requiredMark"></div>
                                    </div>
                                    <div class="clearfix"></div>
                                    <apex:outputPanel id="email_detail" rendered="{!showEmailPreview}">
                                        
                                        <div class="col-md-2 col-sm-2 iframe-sm-2 form-group" style="padding-left:0px;text-align: center;margin-top: 5px;margin-bottom: 0px;">
                                            <label>From</label>
                                        </div>
                                        <div class="col-md-10 col-sm-10 iframe-sm-10 form-group" style="padding-left:0px;">
                                            <apex:inputText value="{!strFromAddress}" styleClass="form-control" disabled="true"/>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="col-md-2 col-sm-2 iframe-sm-2 form-group" style="padding-left:0px;text-align: center;margin-top: 5px;margin-bottom: 0px;">
                                            <label>To</label>
                                        </div>
                                        <div class="col-md-10 col-sm-10 iframe-sm-10 form-group" style="padding-left:0px;">
                                            <apex:inputText value="{!Case.ContactEmail}" styleClass="form-control" disabled="true"/>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="col-md-2 col-sm-2 iframe-sm-2 form-group" style="padding-left:0px;text-align: center;margin-top: 5px;margin-bottom: 0px;">
                                            <label>Cc</label>
                                        </div>
                                        <div class="col-md-10 col-sm-10 iframe-sm-10 form-group" style="padding-left:0px;">
                                            <apex:inputText value="{!strCCAddress}" styleClass="form-control" title="please provide semicolon seperated email addresses"/>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="col-md-2 col-sm-2 iframe-sm-2 form-group" style="padding-left:0px;text-align: center;margin-top: 5px;margin-bottom: 0px;">
                                            <label>Subject</label>
                                        </div>
                                        <div class="col-md-10 col-sm-10 iframe-sm-10 form-group" style="padding-left:0px;">
                                            <apex:inputText value="{!strSubject}" styleClass="form-control" disabled="true"/>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="col-md-12 col-sm-12 iframe-sm-12 form-group" style="padding-left:0px;">
                                            <iframe frameborder="0" height="300" id="contentFrame" name="contentFrame" scrolling="no" src="{!strIframeSrc}" title="" width="500" style="height: 2300px; width: 100%; border: 1px solid black;"></iframe>
                                        </div>
                                        <div class="clearfix"></div>  
                                        <div class="col-md-12 col-sm-12 iframe-sm-12 form-group" style="padding-left:0px;">
                                            <div style="padding: 10px 0px;font-size: 16px;font-weight: bold;">Attachments</div>
                                            <table id="ptpnewtable" class="table table-striped table-bordered" cellspacing="0" width="100%" style="margin-bottom:10px;">
                                                <thead>
                                                    <tr>
                                                        <th>File Name</th>
                                                        <th>File Size</th>
                                                        <th>File Type</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <apex:repeat value="{!lstWrapper}" var="obj">
                                                        <tr>
                                                            <td><a href="/{!obj.strFileId}" target="_blank">{!obj.strFileName}</a></td>
                                                            <td>{!obj.strFileSize}</td>
                                                            <td>{!obj.strFileType}</td>
                                                        </tr>
                                                    </apex:repeat>
                                                </tbody>
                                            </table>
                                            <apex:outputPanel rendered="{!If(lstWrapper != Null && lstWrapper.size > 0,false,true)}">
                                                <div style="padding-left:10px;">No Attachments</div>
                                            </apex:outputPanel>
                                        </div>
                                        <div class="clearfix"></div>
                                    </apex:outputPanel>
                                </section>                           
                            </aside>
                        </apex:outputPanel>
                    </apex:form>
                </div>
            </section>
        </body>
    </html>
</apex:page>